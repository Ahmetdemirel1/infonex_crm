next #: 75

!*!*!*!*!*!*
REMEMBER TO ACTIVATE CODE THAT ACTUALLY SENDS THE email
!*!*!*!*!*!*

TODO: Post-submit modal on company match overwrites everything - should not
      1) DONE - After selecting company on modal, do an AJAX call that returns a JSON with saved company values
      2) DONE - Compare JSON values with values in form
      3) DONE - If there is a difference, close current modal and open a new modal forcing user to choose between differing values
      4) DONE - On new modal have submit form option
      5) If there are no differences between modal and form, submit form with company value updated
      6) Make sure submit (views.py) doesn't overwrite existing values or find a way to show diffs

TODO: 68) Make it possible to substitute a delegate - need work on modal & logic

TODO: 72) Format radio buttons on report select panel
            http://avtex.com/2015/02/bootstrap-radio-buttons-and-checkboxes-in-columns-with-contextual-text-fields/

TODO: 67) Need logic on delegate page to validate and deal with invoice changes

TODO: 74) Make it possible to edit comments in CRM

TODO: 56) pytz timezone conversion to reports (home page chart & call report)
          http://www.saltycrane.com/blog/2009/05/converting-time-zones-datetime-objects-python/

TODO: 70) Intake/queueing system for registrations to be processed (so they donâ€™t get lost)

TODO: 57) Add phone number field to auth.User (this seems complicated) and add to email confirmation etc

TODO: 41) Add title filter to territory creation page

TODO: 69) Add Delegate lists to territory selections

TODO: 47) Edit venue button doesn't work when calling a conference to edit (update - seems ok, but monitor)

TODO: 65) Create various reports for registration dept
       a) Badge report seems off

TODO: 65) Export data http://djangotricks.blogspot.ca/2013/12/how-to-export-data-as-excel.html

TODO: 43) Upload current registration information and link to CRM records
          a) DONE - upload company files
          b) upload last 2 years of person records
          c) split and upload last 2 years of invoice data (2015-present)
          d) figure out how to auto-link person & crm

TODO: 34) registration/forms.py/ConferenceEditForm.clean()

TODO: 11) Search and update registration information
TODO: 12) Report generation

TODO: 20) STARTED - Charts & data on welcome page

TODO: 13) Upload and download information from filemaker
TODO: 14) Admin interface to review changes - esp to category info
TODO: 16) Submit registration from person page in CRM
TODO: 29) Marketing (aka Peter) interface w/ d-b - Excel-esque
TODO: 17) Open web site link to have web form registrations enter into the d/b
TODO: 18) Data Export for David

TODO: 24) Tag system to classify/sort CRM records
          - Try to replicate the way Day One tags work

TODO: 25) Booking system for upcoming appointments

TODO: 28) if no admin access, set error page for accessing admin page

TODO: 42) See what other flags a person has???

TODO: 66) Pre-populate new delegate form based on search criteria

TODO: Consider automating stopwords in delegate.constants.py
      some kind of database-driven function

See avoiding race conditions using F()
    might be an issue with some records and should be implemented
    https://docs.djangoproject.com/en/1.9/ref/models/expressions/#avoiding-race-conditions-using-f

LONGTERM: Put in some kind of machine learning for matching company names - probably a table of match & guess

#############
# DONE
#############

TODO: 55) DONE? - Added URL field to event - need to propagate to forms & web pages (modal - yes, )

TODO: 8) DONE - (BIG) rework territory stuff
         q) DONE - Check if the link on the sidebar takes me to the last territory page or page 1 (as a navigation method)
         s) DONE - Need to implement typeahead on personal selects in manage_territory.html
         p) DONE - Update manage_territory view to hide person-only selects (template-side)
         r) DONE - Add person to territory
         c) DONE - Need to update detail.html to show dynamic content based on whether working a conference
         l) DONE - Implement filter method
         i) DONE - Create user territory list page (recycle search???)
         o) DONE - Update personal list generator to include person selects if for user
         n) DONE - Implement pagination
         m) DONE - Implement update all
         k) DONE - Allow to change conference on index page
         j) DONE - Allow to change conference on sidebar
         a) DONE - Need to update sidebar to dynamically reflect whether working on a conference
         h) DONE - Javascript/python/url to delete individual select
         g) DONE - If admin status - add Manage Territory option to sidebar
         b) DONE - Need to (re)-create page showing all people in territory - territory.html
         f) DONE - Need to (re)-create a page to create territory based on set criteria - manage_territory.html
         d) DONE - Need to create a page for db admin to add a conference - Quick add Modal
TODO: 38) DONE - Fix CSS on detail page for title & company
TODO: 37) DONE - Active button to create new record based on current
TODO: 23) DONE - If territory exists: new person should pre-populate categorization with relevant details
         (This means updating crm.new.py)
TODO: 39) DONE - Fix placement of CRM etc in top bar: Need to add registration link to CRM
TODO: 40) DONE - Get rid of jumbotron except on home pages; add logo to top bar
TODO: 41) DONE - Add territory filter to personal selects
TODO: 2) DONE - Implement new table for invoices
TODO: 44) DONE: Rework registration page.  Flow based on reg status; remove deposit details
TODO: 35) DONE - Check if registration works with event minimally added in crm
          a) DONE - Need to get directly to conference edit page
          b) DONE - Need JS for 'Proceed' button on both instances
TODO: 49) DONE - REWORK delegate/views.py/process_complete_registration starting at line 113
TODO: 50) DONE - On delegate page load, make sure 'required' values are set correctly
TODO: 55) DONE = Need to deal with event option selections on registration processing (currently ignored)
TODO: 9) DONE - Play with pdf maker (ReportLab) and create new invoice & reg note
TODO: 60) DONE - Should I put cc, bcc & to in email form?
TODO: 61) DONE - Email_modal form -
          a) DONE - finish javascript to add blank email lines
          b) DONE - Validate that email addresses are valid
          b) DONE - Validate that there is at least one email address
          c) DONE - Validate that there is a valid message and subject
TODO: DONE - 58) Run makemigrations to deal with making sales credit mandatory for Invoice
TODO: 51) DONE - On delegate page load and relevant changes, calculate tax and total invoice
TODO: 19) DONE - How to send email confirmations?
TODO: DONE - 52) Implement front-end logic for existing delegate
TODO: 45) DONE - On delegate page - need to verify if, on change of conference, the current delegate is registered for that event
TODO: DONE - 26) Date picker widget (https://jqueryui.com/datepicker/)
TODO: 59) DONE - Create new delegate option does not work (oops!)  - work registration module on match_del_list.html and reg_jquery.js
TODO: 62) DONE - Overhaul delegate registration page & logic
          a) DONE BUT DELETE FILES WHEN GOOD - Remove sidebar (match_sidebar.html, sidebar_navbar.html, crm_sidebar.html, company_sidebar.html) & AJAX calls
          b) DONE - update delegate/index.html layout
          c) DONE - add page to confirm company and crm
          d) DONE - update views.py (add new view and update process_registration)
TODO: DONE - 63) When registering from CRM record, company info does not transfer
TODO: 53) DONE - Deal with GST/QST Exemption in registration/billing process
TODO: 62) DONE - Have conference/option end date set automatically based on start date
TODO: 66) Change company field on delegate page from disabled to readonly?  Or create hidden input value & update it
TODO: 64) DONE - Delete unused Ajax calls & templates from delegate tree
TODO: 10) DONE - Post-registration processing page
TODO: 74) DONE - "I know this company is in there" on delegate registration page
      a) DONE - Populate modal with form fields
      b) DONE - Trigger typeahead in company name field
      c) DONE - Backend search logic for match
      d) DONE - Frontend field population logic
      e) DONE - Backend match logic??
TODO: 75) DONE - Fix company search modal to only show results after search
TODO: 73) DONE - Logic to parse postal codes on delegate entry page & search
TODO: 75) DONE - Write sql routine to insert space into all postal codes where needed
TODO: 75) DONE - registration.js - line 113ish - how to respond to json w/ redirect
TODO: 76) DONE?? - delegate/index.py - rewrite to take a get request for a specific reg - start at line 548
DONE - Invoice/reg note rendering failing on following sequence:
  1) new registration
  2) forget to confirm some detail so get taken back to index page (eg. put phone # in email field)
  3) correct & submit
  -- it appears the info is submitted correctly but there is a problem with the pdf render
  -- pre-tax price not being required before submit (lost on return to page with errors)
  -- on choosing delegate free put $0 in price box
TODO: 70) DONE - Delegate page - cxl info doesn't disappear when it should
TODO: DONE - revamp the way company match suggestions are made:
  - see if they can be ordered better
  - trigrams first?
  - use city name?
TODO: DONE - company suggest
      a) name__icontains
      b) deal with escaped characters in regex search
TODO: Salesperson email not appearing on sponsor bookings?
TODO: DONE - Selecting registration by criteria
    registration/views.py - line 375 - kwargs don't apply to reg_details
TODO: DONE - Keep search icon on screen after select
TODO: 46) DONE - PD/Sales report page on notes (works but ugly)
TODO: DONE - Date select for registration page chooses wrong date
TODO: DONE - Make it possible to submit invoice number search with return
TODO: DONE - Advanced search on CRM is broken
TODO: DONE - Need to rework the company search function - screws up when dealing with
      punctuation (commas, slashes, hyphens, etc).
      Also, plural/singular (first nation vs first nations)
      Consider TF/IDF (need to figure out how to best implement this)
TODO: DONE - How to deal with apostrophes from company name whens searching (regex issue)
TODO: DONE - if ! company_match, call modal when pressing enter in company name
TODO: DONE - increase the confidence for recommending crm match
TODO: DONE - consider updating company search to deal with singular/plural (first nation vs first nations)
